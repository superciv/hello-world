mixed-port: 7890 

allow-lan: false 
bind-address: "*"
mode: rule       
log-level: info  
ipv6: true       
unified-delay: false
tcp-concurrent: true
external-controller: 0.0.0.0:9090 
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

geo-auto-update: true # 是否自动更新 geodata
geo-update-interval: 72 # 更新间隔，单位：小时

# 更改geoip使用文件,mmdb或者dat,true为dat
geodata-mode: true
geodata-loader: standard
geox-url:
  geoip: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat"
  geosite: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb"

find-process-mode: strict
global-client-fingerprint: chrome

profile:
  store-selected: true
  # 储存 API 对策略组的选择，以供下次启动时使用
  store-fake-ip: true
  # 储存 fakeip 映射表，域名再次发生连接时，使用原有映射地址

sniffer:                           #【Meta专属】sniffer域名嗅探器
  enable: true                     # 嗅探器开关
  override-destination: false
  sniff: # TLS 默认如果不配置 ports 默认嗅探 443
    TLS:
      ports: [443, 8443]
    HTTP: # 需要嗅探的端口, 默认嗅探 80
      ports: [80, 8080-8880]
      override-destination: true # 可覆盖 sniffer.override-destination
  force-domain:
    - +.v2ex.com
    - "+.netflix.com"
    - "+.nflxvideo.net"
    - "+.amazonaws.com"
    - "+.media.dssott.com"
  # 白名单,跳过嗅探结果
  skip-domain:
    - Mijia Cloud
    - "+.apple.com"
    - dlg.io.mi.com

dns:
  cache-algorithm: arc
  enable: true    
  ipv6: true
  listen: 0.0.0.0:1053 
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - localhost.ptlogin2.qq.com
    - +.msftconnecttest.com
    - +.msftncsi.com
  nameserver:
    - 'tls://8.8.4.4#dns'
    - 'tls://1.1.1.1#dns'
  nameserver-policy:
    "geosite:category-ads-all": rcode://success
    "geosite:cn,private,microsoft@cn,apple@cn,category-games@cn":
      - 119.29.29.29
      - 223.5.5.5
      - system

tun:
  enable: true
  mtu: 1400
  stack: mixed
  device: utun
  dns-hijack:
    - any:53
  auto-route: true
  auto-detect-interface: true
    
proxies: 
  - name: Singapore
    type: 
    server: 
    port: 

proxy-providers:
  Subscribe:
    type: http
    interval: 259200
    health-check: {enable: true, url: http://www.gstatic.com/generate_204, interval: 1800}
    url: 
    path: ./proxy_providers/tmp.yaml


proxy-groups:
  - {name: 国内流量, type: select, proxies: [Singapore, DIRECT]}
  - {name: 国内游戏, type: select, proxies: [DIRECT, Singapore]}
  - {name: 代理流量, type: select, proxies: [Singapore, 自动选择, DIRECT]}
  - {name: 自动选择, type: url-test, lazy: true,  url: http://www.gstatic.com/generate_204, interval: 900, use: [Subscribe]}
  - {name: 美国节点, type: url-test, lazy: true,  url: http://www.gstatic.com/generate_204, interval: 900, use: [Subscribe], filter: "美|US|(?i)States|American"}
  - {name: dns, type: select, proxies: [自动选择, Singapore]}


rule-providers:
  Direct:
    behavior: classical 
    interval: 259200
    path: ./ruleset/Direct.yaml
    type: http 
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Direct/Direct.yaml

rules:
  - PROCESS-NAME,qbittorrent.exe,DIRECT
  - PROCESS-NAME,qq.exe,DIRECT
  - PROCESS-NAME,wechat.exe,DIRECT
  - PROCESS-NAME,WeChatAppEx.exe,DIRECT
  - PROCESS-NAME,WeChatUtility.exe,DIRECT

  - DOMAIN,time.is,DIRECT
  - DOMAIN-SUFFIX,edu.cn,DIRECT
  - DOMAIN-KEYWORD,mikuclub,DIRECT
  - DOMAIN-KEYWORD,hikarifield,DIRECT
  - DOMAIN-KEYWORD,wenku8,DIRECT
  - DOMAIN-KEYWORD,lightnovel,DIRECT
  - DOMAIN-KEYWORD,hikarifield,DIRECT
  - DOMAIN-KEYWORD,clarivate,DIRECT
  - DOMAIN-KEYWORD,webofscience,DIRECT
  - DOMAIN-KEYWORD,sciencedirect,DIRECT

  - GEOIP,private,DIRECT,no-resolve
  - RULE-SET,Direct,DIRECT
  - GEOSITE,category-ads-all,REJECT

  - GEOSITE,bilibili,国内流量
  - GEOSITE,tencent-games,国内游戏
  - GEOSITE,mihoyo-cn,国内游戏
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,google-scholar,自动选择
  - GEOSITE,bing,美国节点
  - GEOSITE,openai,美国节点
  - GEOSITE,anthropic,美国节点
  - GEOSITE,apple,代理流量
  - GEOSITE,github,代理流量
  - GEOSITE,microsoft,代理流量
  - GEOSITE,geolocation-!cn,代理流量

  - GEOIP,google,代理流量
  - GEOIP,telegram,代理流量
  - GEOIP,twitter,代理流量
  - GEOSITE,CN,国内流量
  - GEOIP,CN,国内流量
  - MATCH,代理流量
